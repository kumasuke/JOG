# S3互換サーバー比較分析レポート

**調査日**: 2026年1月24日
**環境**: macOS Darwin 24.6.0, Apple Silicon
**ベンチマークツール**: MinIO Warp v1.4.0

## 概要

JOGと、同様の「ローカルファイルシステムをS3互換APIで公開する」機能を持つ代替ツールのパフォーマンスを比較した。

### 比較対象サーバー

| サーバー | バージョン | バックエンド | 特徴 |
|---------|-----------|-------------|------|
| **JOG** | latest (build) | SQLite + ローカルFS | 軽量、メタデータをSQLiteで管理 |
| **MinIO** | RELEASE.2025-10-15 | 独自フォーマット | エンタープライズ機能、分散対応 |
| **rclone** | v1.72.1 | 任意のrcloneバックエンド | 40種以上のストレージに対応 |
| **versitygw** | v1.1.0 | POSIX / Azure / S3 | 高性能Fiberフレームワーク |

## テスト環境

| 項目 | 値 |
|------|-----|
| OS | macOS (darwin/arm64) |
| CPU | Apple Silicon |
| ツール | MinIO Warp v1.4.0 |
| 並行度 | 16 |
| テスト時間 | 60秒 |
| オブジェクトサイズ | 1MB |
| ワークロード | Mixed (GET 70% / PUT 30%) |

### エンドポイント

| サーバー | ポート |
|---------|--------|
| JOG | localhost:9200 |
| MinIO | localhost:9300 |
| rclone | localhost:9400 |
| versitygw | localhost:9500 |

## 結果サマリー

### スループット比較

| サーバー | スループット (MiB/s) | ops/s | 総リクエスト | エラー |
|---------|---------------------|-------|-------------|--------|
| **rclone** | 478.58 | 669.35 | 40,161 | 0 |
| **JOG** | 462.00 | 646.43 | 38,786 | 0 |
| **versitygw** | 402.22 | 562.70 | 33,762 | 0 |
| **MinIO** | 380.52 | 532.33 | 31,940 | 0 |

### 相対パフォーマンス（MinIOを100%とした場合）

```
rclone     |████████████████████████████████████████| 125.8%
JOG        |█████████████████████████████████████   | 121.4%
versitygw  |██████████████████████████████████      | 105.7%
MinIO      |████████████████████████████████        | 100.0%
```

## 詳細分析

### 1. rclone serve s3（最高スループット）

**結果**: 478.58 MiB/s（MinIO比 **+25.8%**）

rcloneが最も高いスループットを記録した。

**考察**:
- rcloneはVFS（Virtual File System）レイヤーを通じてファイルシステムに直接アクセス
- シンプルなS3プロトコル変換に特化した設計
- メタデータ管理のオーバーヘッドが最小限

**注意点**:
- S3 API実装が限定的（一部の高度なS3機能は未サポート）
- 大規模なオブジェクト一覧やバージョニングには不向きの可能性

### 2. JOG（2位）

**結果**: 462.00 MiB/s（MinIO比 **+21.4%**）

JOGはrcloneに次いで高いスループットを達成。

**強み**:
- SQLiteによる効率的なメタデータ管理
- シンプルな単一ノード向け設計
- 軽量なHTTPサーバー実装

**rcloneとの差（-3.5%）の理由**:
- SQLiteへのメタデータ書き込みオーバーヘッド
- ただし、この差はメタデータ管理の恩恵（一覧取得の高速化等）とのトレードオフ

### 3. versitygw（3位）

**結果**: 402.22 MiB/s（MinIO比 **+5.7%**）

**特徴**:
- Fiberフレームワークによる高性能HTTP処理
- POSIXバックエンドの直接アクセス
- AWS SDK互換性を重視した実装

**注意点**:
- デフォルトで `us-east-1` リージョンを使用（環境変数 `VGW_REGION` で変更可能）
- エンタープライズ向け機能を持つため若干のオーバーヘッド

### 4. MinIO（4位）

**結果**: 380.52 MiB/s（ベースライン）

**考察**:
MinIOは機能的に最も充実しているが、単一ノードでのシンプルなワークロードでは他のツールに比べてオーバーヘッドが大きい。

**オーバーヘッドの要因**:
- 分散ストレージ機能（Erasure Coding等）
- エンタープライズ機能（監査ログ、暗号化等）
- 独自のメタデータ形式

**MinIOが適しているケース**:
- 分散環境での高可用性が必要
- エンタープライズ機能（監査、暗号化、レプリケーション）が必要
- 大規模クラスタでの運用

## ユースケース別推奨

| ユースケース | 推奨サーバー | 理由 |
|-------------|-------------|------|
| **開発・テスト環境** | JOG / rclone | 軽量で高速、セットアップが簡単 |
| **バックアップストレージ** | JOG | SQLiteでメタデータ管理、高速な一覧取得 |
| **既存rcloneバックエンドの活用** | rclone | 40種以上のストレージに対応 |
| **既存POSIXストレージのS3化** | versitygw | 直接POSIXアクセス |
| **エンタープライズ環境** | MinIO | 分散、高可用性、監査機能 |
| **Litestream連携** | JOG | SQLiteベースでレプリケーション可能 |

## 機能比較

| 機能 | JOG | MinIO | rclone | versitygw |
|------|-----|-------|--------|-----------|
| PUT/GET基本操作 | ✓ | ✓ | ✓ | ✓ |
| マルチパートアップロード | ✓ | ✓ | ✓ | ✓ |
| ListObjectsV2 | ✓ | ✓ | ✓ | ✓ |
| バージョニング | - | ✓ | - | ✓ |
| バケットポリシー | - | ✓ | - | ✓ |
| 分散ストレージ | - | ✓ | - | - |
| Web Console | - | ✓ | - | - |
| SQLメタデータ | ✓ | - | - | - |
| Litestream連携 | ✓ | - | - | - |

## 結論

### JOGの代替可能性について

**結論**: rclone serve s3 と versitygw は、JOGと同様に「ローカルファイルシステムをS3互換APIで公開する」機能を持ち、代替として使用可能。

ただし、以下の点でJOGには独自の価値がある：

1. **SQLiteベースのメタデータ管理**
   - オブジェクト一覧の高速取得
   - Litestreamによるレプリケーション対応

2. **バランスの取れたパフォーマンス**
   - rcloneに次ぐ高スループット
   - メタデータ管理の恩恵を受けつつ高速

3. **シンプルな運用**
   - 単一バイナリ
   - 設定が少ない

### パフォーマンス順位

```
1. rclone     - 478.58 MiB/s  (最高速、シンプルな変換)
2. JOG        - 462.00 MiB/s  (SQLite管理付きで高速)
3. versitygw  - 402.22 MiB/s  (POSIX直接アクセス)
4. MinIO      - 380.52 MiB/s  (機能豊富だがオーバーヘッド大)
```

## 付録: 生データ

### Warpベンチマーク結果（Mixed Workload, 60秒）

#### JOG
```json
{
  "total_requests": 38786,
  "total_bytes": 29066526720,
  "total_errors": 0,
  "concurrency": 16,
  "throughput_mib_s": 462,
  "ops_per_sec": 646.43
}
```

#### MinIO
```json
{
  "total_requests": 31940,
  "total_bytes": 23940038656,
  "total_errors": 0,
  "concurrency": 16,
  "throughput_mib_s": 380.52,
  "ops_per_sec": 532.33
}
```

#### rclone
```json
{
  "total_requests": 40161,
  "total_bytes": 30109859840,
  "total_errors": 0,
  "concurrency": 16,
  "throughput_mib_s": 478.58,
  "ops_per_sec": 669.35
}
```

#### versitygw
```json
{
  "total_requests": 33762,
  "total_bytes": 25305284608,
  "total_errors": 0,
  "concurrency": 16,
  "throughput_mib_s": 402.22,
  "ops_per_sec": 562.70
}
```

## 参考資料

- [rclone serve s3](https://rclone.org/commands/rclone_serve_s3/)
- [Versity Gateway](https://github.com/versity/versitygw)
- [MinIO](https://min.io/)
- [MinIO Warp](https://github.com/minio/warp)
